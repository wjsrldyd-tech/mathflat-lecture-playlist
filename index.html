<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MathFlat ì˜ìƒ ëª¨ìŒ</title>
<style>
body { 
  font-family: 'Malgun Gothic', sans-serif; 
  padding: 20px; 
  margin: 0;
}
.container {
  display: flex;
  gap: 20px;
  height: calc(100vh - 40px);
}
.left-panel {
  width: 300px;
  flex-shrink: 0;
  overflow-y: auto;
}
.right-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
}
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}
h2 {
  margin: 0;
}
.add-btn {
  padding: 8px 16px;
  background: #4CAF50;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
}
.add-btn:hover {
  background: #45a049;
}
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
}
.modal-content {
  background-color: #fefefe;
  margin: 10% auto;
  padding: 20px;
  border: 1px solid #888;
  border-radius: 10px;
  width: 80%;
  max-width: 600px;
}
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}
.close {
  color: #aaa;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}
.close:hover {
  color: #000;
}
.json-input {
  width: 100%;
  min-height: 200px;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 5px;
  font-family: 'Courier New', monospace;
  font-size: 12px;
  resize: vertical;
  box-sizing: border-box;
}
.modal-actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 15px;
}
.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
}
.btn-primary {
  background: #4CAF50;
  color: white;
}
.btn-primary:hover {
  background: #45a049;
}
.btn-secondary {
  background: #f44336;
  color: white;
}
.btn-secondary:hover {
  background: #da190b;
}
.video-list { 
  list-style: none; 
  padding: 0; 
  margin: 0;
}
.video-item { 
  padding: 10px; 
  margin: 5px 0; 
  background: #f5f5f5; 
  border-radius: 5px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.video-item:hover { 
  background: #e0e0e0; 
}
.video-item-text {
  flex: 1;
}
.delete-btn {
  background: #f44336;
  color: white;
  border: none;
  border-radius: 3px;
  padding: 5px 10px;
  cursor: pointer;
  font-size: 12px;
  margin-left: 10px;
}
.delete-btn:hover {
  background: #da190b;
}
#player { 
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 0;
}
video { 
  width: 100%; 
  height: 100%;
  max-height: 100%;
  object-fit: contain;
}
</style>
</head>
<body>

<div class="container">
  <div class="left-panel">
    <div class="header">
      <h2>ğŸ“š ë‚´ ê°•ì˜ ì˜ìƒ ëª¨ìŒ</h2>
      <button class="add-btn" id="addBtn">â• ë¶™ì—¬ë„£ê¸°ë¡œ ì¶”ê°€</button>
    </div>
    <ul class="video-list" id="videoList">
      <!-- ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
    </ul>
  </div>
  
  <div class="right-panel">
    <div id="player">
      <video id="videoPlayer" controls></video>
    </div>
  </div>
</div>

<!-- ëª¨ë‹¬ -->
<div id="addModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>ì˜ìƒ ì¶”ê°€</h3>
      <span class="close" id="closeModal">&times;</span>
    </div>
    <p>ë¶ë§ˆí¬ë¦¿ìœ¼ë¡œ ë³µì‚¬í•œ JSONì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”:</p>
    <textarea id="jsonInput" class="json-input" placeholder='[{"title":"ë¬¸ì œ 123","url":"https://..."}]'></textarea>
    <div class="modal-actions">
      <button class="btn btn-secondary" id="cancelBtn">ì·¨ì†Œ</button>
      <button class="btn btn-primary" id="saveBtn">ì¶”ê°€</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
// ì´ˆê¸° ë°ì´í„° (í•˜ë“œì½”ë“œëœ ë¦¬ìŠ¤íŠ¸)
const initialVideos = [
  { title: 'ğŸ“ ë¬¸ì œ 898385 - ì„¤ëª… ì˜ìƒ', url: 'https://video.mathflat.com/problem/898385/595627f4abb53bdea11b40a0ef00a78b/video-1080p.m3u8' },
  { title: 'ğŸ“Š ë¬¸ì œ XXXXXX - ì„¤ëª… ì˜ìƒ', url: 'https://video.mathflat.com/problem/898855/0749ce58b99d69390561288c9934faee/video-1080p.m3u8' }
];

// localStorage í‚¤
const STORAGE_KEY = 'mathflat_videos';

// ë¹„ë””ì˜¤ ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬
let videos = [];

// localStorageì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
function loadVideos() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    try {
      videos = JSON.parse(saved);
    } catch (e) {
      console.error('ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', e);
      videos = [...initialVideos];
    }
  } else {
    videos = [...initialVideos];
  }
  renderVideos();
}

// localStorageì— ì €ì¥
function saveVideos() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(videos));
}

// ë¹„ë””ì˜¤ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
function renderVideos() {
  const videoList = document.getElementById('videoList');
  videoList.innerHTML = '';
  
  videos.forEach((video, index) => {
    const li = document.createElement('li');
    li.className = 'video-item';
    li.setAttribute('data-src', video.url);
    
    const textSpan = document.createElement('span');
    textSpan.className = 'video-item-text';
    textSpan.textContent = video.title;
    
    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'delete-btn';
    deleteBtn.textContent = 'ğŸ—‘ï¸';
    deleteBtn.onclick = (e) => {
      e.stopPropagation();
      if (confirm('ì´ ì˜ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        videos.splice(index, 1);
        saveVideos();
        renderVideos();
      }
    };
    
    li.appendChild(textSpan);
    li.appendChild(deleteBtn);
    
    // í´ë¦­ ì´ë²¤íŠ¸
    li.addEventListener('click', function(e) {
      if (e.target !== deleteBtn && e.target !== deleteBtn) {
        playVideo(video.url);
        // ì„ íƒëœ í•­ëª© ê°•ì¡°
        document.querySelectorAll('.video-item').forEach(i => i.style.background = '#f5f5f5');
        this.style.background = '#ffd700';
      }
    });
    
    videoList.appendChild(li);
  });
}

// ë¹„ë””ì˜¤ ì¬ìƒ
const video = document.getElementById('videoPlayer');
function playVideo(videoSrc) {
  if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(videoSrc);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      video.play();
    });
  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = videoSrc;
    video.addEventListener('loadedmetadata', () => {
      video.play();
    });
  }
}

// ëª¨ë‹¬ ê´€ë¦¬
const addBtn = document.getElementById('addBtn');
const modal = document.getElementById('addModal');
const closeModal = document.getElementById('closeModal');
const cancelBtn = document.getElementById('cancelBtn');
const saveBtn = document.getElementById('saveBtn');
const jsonInput = document.getElementById('jsonInput');

addBtn.onclick = () => {
  modal.style.display = 'block';
  jsonInput.value = '';
  jsonInput.focus();
};

closeModal.onclick = () => {
  modal.style.display = 'none';
};

cancelBtn.onclick = () => {
  modal.style.display = 'none';
};

saveBtn.onclick = () => {
  const jsonText = jsonInput.value.trim();
  if (!jsonText) {
    alert('JSONì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  try {
    const newVideos = JSON.parse(jsonText);
    if (!Array.isArray(newVideos)) {
      throw new Error('ë°°ì—´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
    }
    
    let addedCount = 0;
    let skippedCount = 0;
    
    newVideos.forEach(newVideo => {
      if (!newVideo.title || !newVideo.url) {
        skippedCount++;
        return;
      }
      
      // ì¤‘ë³µ ì²´í¬ (URL ê¸°ì¤€)
      const isDuplicate = videos.some(v => v.url === newVideo.url);
      if (!isDuplicate) {
        videos.push({ title: newVideo.title, url: newVideo.url });
        addedCount++;
      } else {
        skippedCount++;
      }
    });
    
    if (addedCount > 0) {
      saveVideos();
      renderVideos();
      alert(`âœ… ${addedCount}ê°œ í•­ëª©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.${skippedCount > 0 ? `\n${skippedCount}ê°œ í•­ëª©ì€ ì¤‘ë³µë˜ì–´ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤.` : ''}`);
      modal.style.display = 'none';
    } else {
      alert('ì¶”ê°€í•  ìˆ˜ ìˆëŠ” í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. (ëª¨ë‘ ì¤‘ë³µë˜ì—ˆê±°ë‚˜ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.)');
    }
  } catch (e) {
    alert('JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.\nì˜¤ë¥˜: ' + e.message);
  }
};

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
window.onclick = (event) => {
  if (event.target === modal) {
    modal.style.display = 'none';
  }
};

// ì´ˆê¸°í™”
loadVideos();
</script>

</body>
</html>